{% extends "layouts/partner-base.html" %}

{% load custom_tags %}

{% block title %} Recharge {% endblock %}


{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

<style>
    /* Jquery validation */
    label {
        border: 0;
        margin-bottom: 3px;
        display: block;
        width: 100%;
    }

    /* Datatable => to float button right  */
    div.dt-buttons {
        position: relative;
        float: right;
        border-radius: 20px;
    }

    /* Datatable => rounded corner button  */
    button.dt-button {
        border-radius: 20px;
    }

    .permission-denied {
        color: red;
        display: flex;
        justify-content: center;
        font-size: 25px;
        font-weight: 500;
    }
</style>
<div class="content">
    <div class="page-inner">
         <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header" style="justify-content: center">
                        <a style="font-size: 20px;"><b>Recharge</b></a>
                        <ul class="breadcrumbs">
                            <li class="nav-home">
                                <a href="/partner-index/">
                                    <i class="flaticon-home"></i>
                                </a>
                            </li>
                            <li class="separator">
                                <i class="flaticon-right-arrow"></i>
                            </li>
                            <li class="nav-item">
                                <a>My Subscriptions</a>
                            </li>
                            <li class="separator">
                                <i class="flaticon-right-arrow"></i>
                            </li>
                            <li class="nav-item">
                                <a href="/partner-recharge/">Recharge</a>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="card-body">
                                    <div class="row">     
                                        <div class="col-md-12 form-control">
                                            <ul class="nav nav-pills mb-5" id="v-pills-tab"
                                                        role="tablist" style="display: flex;justify-content: center;">

                                                {% if partner_user_id.p_category == "Software Partner" %}
                                                <li class="nav-item">
                                                    <a class="nav-link active" id="v-pills-subscription-tab" data-toggle="pill" href="#v-pills-subscription" role="tab" aria-controls="v-pills-subscription" aria-selected="true">Green Bill Subscription Plan</a>
                                                </li>
                                                {% endif %}
                                                <li class="nav-item">
                                                     <!--  {% if m_business_category_name != "Petrol Pump" and m_business_category_name != "Parking Lot" %} -->
                                                      <a class="nav-link {% if partner_user_id.p_category != 'Software Partner' %} active {% endif %}" id="v-pills-promotional-sms-tab" data-toggle="pill" href="#v-pills-promotional-sms" role="tab" aria-controls="v-pills-promotional-sms" aria-selected="false">Promotional SMS Plan</a>
                                                     <!--  {% endif %} -->
                                                </li>
                                                <li class="nav-item">
                                             <!-- {% if m_business_category_name != "Petrol Pump" and m_business_category_name != "Parking Lot" %} -->
                                              <a class="nav-link" id="v-pills-transactional-sms-tab" data-toggle="pill" href="#v-pills-transactional-sms" role="tab" aria-controls="v-pills-transactional-sms" aria-selected="false">Transactional SMS Plan</a>
                                              <!-- {% endif %} -->
                                                </li>  
                                                <!-- <li class="nav-item">
                                                     <a class="nav-link" id="v-pills-add-on-tab" data-toggle="pill" href="#v-pills-add-on" role="tab" aria-controls="v-pills-add-on" aria-selected="true">Add On's Plan</a>
                                                </li>     -->
                                            </ul>
                                        </div>
                                    </div>
                               </div>
                            <!-- <div class="col-md-3">
                                <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                                  <a class="nav-link active" id="v-pills-subscription-tab" data-toggle="pill" href="#v-pills-subscription" role="tab" aria-controls="v-pills-subscription" aria-selected="true">Green Bill Subscription Plan</a>

                                  <a class="nav-link" id="v-pills-promotional-sms-tab" data-toggle="pill" href="#v-pills-promotional-sms" role="tab" aria-controls="v-pills-promotional-sms" aria-selected="false">Promotional SMS Plan</a>

                                  <a class="nav-link" id="v-pills-transactional-sms-tab" data-toggle="pill" href="#v-pills-transactional-sms" role="tab" aria-controls="v-pills-transactional-sms" aria-selected="false">Transactional SMS Plan</a>
                                  
                                  <a class="nav-link" id="v-pills-add-on-tab" data-toggle="pill" href="#v-pills-add-on" role="tab" aria-controls="v-pills-add-on" aria-selected="true">Add On's Plan</a>
                                </div>
                            </div>

 -->                        

                            <div class="col-md-12">
                                <div class="tab-content" id="v-pills-tabContent">
                                    {% if partner_user_id.p_category == "Software Partner" %}
                                    <div class="tab-pane fade show active" id="v-pills-subscription" role="tabpanel" aria-labelledby="v-pills-subscription-tab">
                                        {% for object in subscriptions_list %}
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-sm-2">
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <section style="padding-left: 15px;">
                                                                <span><b>Subscription Name</b></span>
                                                                <h1 style="color:#63b90b;font-size: 18px;"><b>{{ object.subscription_name }}</b></h1>
                                                            </section>
                                                        </div>
                                                        <!-- <div class="col-sm-3">
                                                            <section>
                                                                <span><b>Validity</b></span>
                                                                <h1 style="color:#63b90b;font-size: 14px;"><b>{{ object.valid_for_month }} Month</b></h1>
                                                            </section>
                                                        </div> -->
                                                        <div class="col-sm-2">
                                                            <section>
                                                                <span><b>Amount</b></span>
                                                                <h1 style="font-size: 20px; Color:#ffad47"><b>â‚¹ {{object.subscription_plan_cost|floatformat:3}}</b></h1>
                                                            </section>
                                                        </div>
                                                        <div class="col-sm-3" style="padding-top: 5px">
                                                            <!-- <form method="POST" action="{{ action }}">
                                                                {% csrf_token %} -->
                                                                <input type="hidden" name="key" value="{{ MERCHANT_KEY }}" />
                                                                <input type="hidden" name="hash_string" value="{{ object.hash_string }}" />
                                                                <input type="hidden" name="hash" value="{{ object.hashh }}"/>
                                                                <input type="hidden" name="posted" value="{{ object.posted }}"/>
                                                                <input type="hidden" name="txnid" value="{{ object.txnid }}" />
                                                                <input type="hidden" name="amount" value="{{ object.amount }}" />
                                                                <input type="hidden" name="firstname" id="firstname" value="{{ firstname }}" />
                                                                <input type="hidden" name="productinfo" value="{{ object.productinfo }}">
                                                                <input type="hidden" name="email" value="{{email}}">
                                                                <input type="hidden" name="phone" value="{{phone}}">
                                                                <input type="hidden" name="surl" value="{{surl}}">
                                                                <input type="hidden" name="furl" value="{{furl}}">
                                                                <input type="hidden" name="udf1" value="{{ object.udf1 }}">
                                                                <input type="hidden" name="udf2" value="{{ object.udf2 }}">
                                                                <input type="hidden" name="udf3" value="{{ object.udf3 }}">
                                                                <input type="hidden" name="udf4" value="{{ object.udf4 }}">
                                                                <input type="hidden" name="udf5" value="{{ object.udf5 }}">
                                                                <input type="hidden" name="udf6" value="{{ object.udf6 }}">
                                                                <input type="hidden" name="subscription_id" value="{{ object.id }}">
                                                                <button type="button" class="btn btn-link" data-toggle="modal" data-target="#viewdetailsmodal_{{forloop.counter}}" style="padding: .65rem 0.6rem;">View Details</button>
                                                                <!-- <button type="submit" class="btn btn-sm" style="background-color: #06529e; color:white">Buy</button> -->
                                                                <button type="button" ype="button" class="btn btn-sm buymodalBtn" style="background-color: #06529e; color:white" data-plan-id="{{ object.id}}"
                                                                data-number_of_users="{{ object.number_of_users }}"
                                                                data-cost_for_users="{{object.cost_for_users}}"
                                                                data-gst_amount="{{object.gst_amount}}" data-recharge_amount="{{ object.subscription_plan_cost }}">Buy</button>
                                                            <!-- </form> -->
                                                        </div>
                                                    </div>
                                                    <div class="modal fade" id="viewdetailsmodal_{{forloop.counter}}">
                                                        <div class="modal-dialog">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <h3 class="modal-title w-100 text-center">{{ object.subscription_name }}</h3>
                                                                    <button type="button" class="close" data-dismiss="modal">
                                                                        Ã—
                                                                    </button>
                                                                </div>
                                                                <div class="modal-body">
                                                                    <section
                                                                        style="background-color :#06529e;border-radius:20px;border:2px solid #1572e9">
                                                                        <p style="text-align:center;"> <br>
                                                                            <span
                                                                                style="color:white;text-align:center;font-size:50px;"><b>
                                                                                    â‚¹ {{object.subscription_plan_cost|floatformat:3}}</b></span>
                                                                            <br>
                                                                            <span style="color: white;">
                                                                                <b>Plan For - 
                                                                                {% if object.valid_for_month == 1%}
                                                                                    {{object.valid_for_month}} Month
                                                                                {% else %}
                                                                                    {{object.valid_for_month}} Months
                                                                                {% endif %}
                                                                                </b>
                                                                            </span>
                                                                        </p><br>

                                                                    </section>
                                                                    <hr>
                                                                    <p style="text-align: left;color: black; font-size: 15px;  padding-left: 5px;">
                                                                            Subscription Name
                                                                        <span style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                            Recharge Amount
                                                                        </span>
                                                                        <br>
                                                                        <b>{{ object.subscription_name }}</b>

                                                                        <span
                                                                            style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                            <b> â‚¹ {{ object.recharge_amount|floatformat:3 }}</b>
                                                                        </span>
                                                                    </p>

                                                                    {% if object.category_id == 11 or object.category_id == 12 %}
                                                                        <p style="text-align: left;color: black; font-size: 15px;  padding-left: 5px;">
                                                                                Per Bill Cost
                                                                            <span style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                                Per Digital Bill Cost
                                                                            </span>
                                                                            <br>
                                                                            <b>â‚¹ {{ object.per_bill_cost|floatformat:3 }}</b>
                                                                            <span
                                                                                style="float:right; color: black;text-align:left;padding-right: 10px">
                                                                                <b>â‚¹ {{object.per_digital_bill_cost|floatformat:3}}</b></span>
                                                                        </p>
                                                                    {% else %}
                                                                        <p style="text-align: left;color: black; font-size: 15px;  padding-left: 5px;">
                                                                                Per Bill Cost
                                                                            <span style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                                Per Digital Bill Cost
                                                                            </span>
                                                                            <br>
                                                                            <b>â‚¹ {{ object.per_bill_cost|floatformat:3 }}</b>
                                                                            <span
                                                                                style="float:right; color: black;text-align:left;padding-right: 10px">
                                                                                <b>â‚¹ {{object.per_digital_bill_cost|floatformat:3}}</b></span>
                                                                        </p>
                                                                        <!-- <p style="text-align: left; color: black;font-size: 15px;  padding-left: 5px;">
                                                                            Per Receipt Cost
                                                                            <span style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                                Per Digital Receipt Cost
                                                                            </span>
                                                                            <br>
                                                                            <b> â‚¹ {{object.per_receipt_cost}}</b>
                                                                            <span
                                                                                style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                                <b> â‚¹ {{object.per_digital_receipt_cost}}</b></span>
                                                                        </p> -->
                                                                        <!-- <p style="text-align: left; color: black;font-size: 15px;  padding-left: 5px;">
                                                                            Per Cash Memo Cost
                                                                            <span style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                                Per Digital Cash Memo Cost
                                                                            </span>
                                                                            <br>
                                                                            <b> â‚¹ {{object.per_cash_memo_cost}}</b>
                                                                            <span
                                                                                style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                                <b> â‚¹ {{object.per_digital_cash_memo_cost}}</b></span>
                                                                        </p> -->
                                                                    {% endif %}
                                                                    <!-- <p align="center" style="color: red">
                                                                        (Software Maintainance Cost: â‚¹ {{object.software_maintainace_cost}})
                                                                    </p> -->
                                                                    <p align="center" style="color: red">
                                                                            {% if sgst_value == 1 %}
                                                                            (CGST: 0) (SGST: 0)<br>
                                                                            (include IGST: 18%)
                                                                            {% endif %}
                                                                            {% if igst_value == 1 %}
                                                                            (CGST: 9%) (SGST: 9%)
                                                                            (IGST: 0)
                                                                            {% endif %}
                                                                        </p>

                                                                </div>
                                                                <div class="modal-footer">
                                                                    <!-- <button type="button" class="btn"
                                                                        style="background-color: #06529e; color:white">
                                                                        Buy
                                                                    </button> -->
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                    <div class="tab-pane fade {% if partner_user_id.p_category != 'Software Partner' %} show active {% endif %}" id="v-pills-promotional-sms" role="tabpanel" aria-labelledby="v-pills-promotional-sms-tab">
                                        {% for object in promotional_sms_plans_list %}
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-sm-3">
                                                            <section style="padding-left: 15px;">
                                                                <span><b>Subscription Name</b></span>
                                                                <h1 style="color:#63b90b;font-size: 18px;"><b>{{ object.subscription_name }}</b></h1>
                                                            </section>
                                                        </div>
                                                        <div class="col-sm-2">
                                                            <section>
                                                                <span><b>Total SMS</b></span>
                                                                <h1 style="color:#63b90b;font-size: 14px;"><b>{{ object.total_sms }}</b></h1>
                                                            </section>
                                                        </div>
                                                        <div class="col-sm-2">
                                                            <section>
                                                                <span><b>Per SMS Cost</b></span>
                                                                <h1 style="color:#63b90b;font-size: 14px;"><b>â‚¹ {{ object.per_sms_cost|floatformat:3 }}</b></h1>
                                                            </section>
                                                        </div>
                                                        <div class="col-sm-2">
                                                            <section>
                                                                <span><b>Amount</b></span>
                                                                <h1 style="font-size: 20px; Color:#ffad47"><b>â‚¹ {{object.total_cost_without_gst|floatformat:3}}</b></h1>
                                                            </section>
                                                        </div>
                                                        <div class="col-sm-3" style="padding-top: 5px">
                                                            <form method="POST" action="{{ action }}">
                                                                {% csrf_token %}
                                                                <input type="hidden" name="key" value="{{ MERCHANT_KEY }}" />
                                                                <input type="hidden" name="hash_string" value="{{ object.hash_string }}" />
                                                                <input type="hidden" name="hash" value="{{ object.hashh }}"/>
                                                                <input type="hidden" name="posted" value="{{ object.posted }}"/>
                                                                <input type="hidden" name="txnid" value="{{ object.txnid }}" />
                                                                <input type="hidden" name="amount" value="{{ object.amount }}" />
                                                                <input type="hidden" name="firstname" id="firstname" value="{{ firstname }}" />
                                                                <input type="hidden" name="productinfo" value="{{ object.productinfo }}">
                                                                <input type="hidden" name="email" value="{{email}}">
                                                                <input type="hidden" name="phone" value="{{phone}}">
                                                                <input type="hidden" name="surl" value="{{promotional_sms_surl}}">
                                                                <input type="hidden" name="furl" value="{{promotional_sms_furl}}">
                                                                <input type="hidden" name="udf1" value="{{ object.udf1 }}">
                                                                <input type="hidden" name="udf2" value="{{ object.udf2 }}">
                                                                <input type="hidden" name="udf3" value="{{ object.udf3 }}">
                                                                <input type="hidden" name="udf4" value="{{ object.udf4 }}">
                                                                <input type="hidden" name="udf5" value="{{ object.udf5 }}">
                                                                <input type="hidden" name="udf6" value="{{ object.udf6 }}">
                                                                <input type="hidden" name="subscription_id" value="{{ object.id }}">
                                                                <button type="button" class="btn btn-link" data-toggle="modal" data-target="#viewPromotionalPlandetailsmodal_{{forloop.counter}}" style="padding: .65rem 0.6rem;">View Details</button>
                                                                <button type="submit" class="btn btn-sm" style="background-color: #06529e; color:white">Buy</button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="modal fade" id="viewPromotionalPlandetailsmodal_{{forloop.counter}}">
                                                        <div class="modal-dialog">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <h3 class="modal-title w-100 text-center">{{ object.subscription_name }}</h3>
                                                                    <button type="button" class="close" data-dismiss="modal">
                                                                        Ã—
                                                                    </button>
                                                                </div>
                                                                <div class="modal-body">
                                                                    <section
                                                                        style="background-color :#06529e;border-radius:20px;border:2px solid #1572e9">
                                                                        <p style="text-align:center;"> <br>
                                                                            <span
                                                                                style="color:white;text-align:center;font-size:50px;"><b>
                                                                                    â‚¹ {{object.total_sms_cost|floatformat:3}}</b></span>
                                                                        </p><br>
                                                                    </section>
                                                                    <hr>
                                                                    <p style="text-align: left;color: black; font-size: 15px;  padding-left: 5px;">
                                                                        Subscription Name
                                                                        <span style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                            Total Amount
                                                                        </span>
                                                                        <br>
                                                                        <b>{{ object.subscription_name }}</b>

                                                                        <span
                                                                            style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                            <b> â‚¹ {{ object.total_cost_without_gst|floatformat:3 }}</b>
                                                                        </span>
                                                                    </p>
                                                                    <p style="text-align: left;color: black; font-size: 15px;  padding-left: 5px;">
                                                                        Total SMS
                                                                        <span style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                            Per SMS Cost
                                                                        </span>
                                                                        <br>
                                                                        <b>{{ object.total_sms }}</b>
                                                                        <span
                                                                            style="float:right; color: black;text-align:left;padding-right: 10px">
                                                                            <b>â‚¹ {{object.per_sms_cost|floatformat:3}}</b>
                                                                        </span>
                                                                    </p>
                                                                    <p align="center" style="color: red">
                                                                            {% if sgst_value == 1 %}
                                                                            (CGST: 0) (SGST: 0)<br>
                                                                            (IGST: 18%): â‚¹{{object.gst_amount|floatformat:2}}<br>
                                                                            {% endif %}
                                                                            {% if igst_value == 1 %}
                                                                            (CGST: 9%): â‚¹{{object.state_wise_gst|floatformat:2}}<br>
                                                                            (SGST: 9%): â‚¹{{object.state_wise_gst|floatformat:2}}<br>
                                                                            (IGST: 0)
                                                                            {% endif %}
                                                                        </p>

                                                                </div>
                                                                <div class="modal-footer">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                        <!-- <p align="center" style="color: red">
                                        (Software Maintainance Cost: â‚¹ {{object.software_maintainace_cost}})
                                        </p> -->
                                    </div>
                                    <div class="tab-pane fade" id="v-pills-transactional-sms" role="tabpanel" aria-labelledby="v-pills-transactional-sms-tab">
                                            {% for object in transactional_sms_plans_list %}
                                                <div class="card">
                                                    <div class="card-body">
                                                        <div class="row">
                                                            <div class="col-sm-3">
                                                                <section style="padding-left: 15px;">
                                                                    <span><b>Subscription Name</b></span>
                                                                    <h1 style="color:#63b90b;font-size: 18px;"><b>{{ object.subscription_name }}</b></h1>
                                                                </section>
                                                            </div>
                                                            <div class="col-sm-2">
                                                                <section>
                                                                    <span><b>Total SMS</b></span>
                                                                    <h1 style="color:#63b90b;font-size: 14px;"><b>{{ object.total_sms }}</b></h1>
                                                                </section>
                                                            </div>
                                                            <div class="col-sm-2">
                                                                <section>
                                                                    <span><b>Per SMS Cost</b></span>
                                                                    <h1 style="color:#63b90b;font-size: 14px;"><b>â‚¹ {{ object.per_sms_cost|floatformat:3 }}</b></h1>
                                                                </section>
                                                            </div>
                                                            <div class="col-sm-2">
                                                                <section>
                                                                    <span><b>Amount</b></span>
                                                                    <h1 style="font-size: 20px; Color:#ffad47"><b>â‚¹ {{object.total_cost_without_gst|floatformat:3}}</b></h1>
                                                                </section>
                                                            </div>
                                                            <div class="col-sm-3" style="padding-top: 5px">
                                                                <form method="POST" action="{{ action }}">
                                                                    {% csrf_token %}
                                                                    <input type="hidden" name="key" value="{{ MERCHANT_KEY }}" />
                                                                    <input type="hidden" name="hash_string" value="{{ object.hash_string }}" />
                                                                    <input type="hidden" name="hash" value="{{ object.hashh }}"/>
                                                                    <input type="hidden" name="posted" value="{{ object.posted }}"/>
                                                                    <input type="hidden" name="txnid" value="{{ object.txnid }}" />
                                                                    <input type="hidden" name="amount" value="{{ object.amount }}" />
                                                                    <input type="hidden" name="firstname" id="firstname" value="{{ firstname }}" />
                                                                    <input type="hidden" name="productinfo" value="{{ object.productinfo }}">
                                                                    <input type="hidden" name="email" value="{{email}}">
                                                                    <input type="hidden" name="phone" value="{{phone}}">
                                                                    <input type="hidden" name="surl" value="{{transactional_sms_surl}}">
                                                                    <input type="hidden" name="furl" value="{{transactional_sms_furl}}">
                                                                    <input type="hidden" name="udf1" value="{{ object.udf1 }}">
                                                                    <input type="hidden" name="udf2" value="{{ object.udf2 }}">
                                                                    <input type="hidden" name="udf3" value="{{ object.udf3 }}">
                                                                    <input type="hidden" name="udf4" value="{{ object.udf4 }}">
                                                                    <input type="hidden" name="udf5" value="{{ object.udf5 }}">
                                                                    <input type="hidden" name="udf6" value="{{ object.udf6 }}">
                                                                    <input type="hidden" name="subscription_id" value="{{ object.id }}">
                                                                    <button type="button" class="btn btn-link" data-toggle="modal" data-target="#viewTransactionalPlandetailsmodal_{{forloop.counter}}" style="padding: .65rem 0.6rem;">View Details</button>
                                                                    <button type="submit" class="btn btn-sm" style="background-color: #06529e; color:white">Buy</button>
                                                                </form>
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="modal fade" id="viewTransactionalPlandetailsmodal_{{forloop.counter}}">
                                                            <div class="modal-dialog">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h3 class="modal-title w-100 text-center">{{ object.subscription_name }}</h3>
                                                                        <button type="button" class="close" data-dismiss="modal">
                                                                            Ã—
                                                                        </button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <section
                                                                            style="background-color :#06529e;border-radius:20px;border:2px solid #1572e9">
                                                                            <p style="text-align:center;"> <br>
                                                                                <span
                                                                                    style="color:white;text-align:center;font-size:50px;"><b>
                                                                                        â‚¹ {{object.total_sms_cost|floatformat:3}}</b></span>
                                                                            </p><br>
                                                                        </section>
                                                                        <hr>
                                                                        <p style="text-align: left;color: black; font-size: 15px;  padding-left: 5px;">
                                                                            Subscription Name
                                                                            <span style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                                Total Amount
                                                                            </span>
                                                                            <br>
                                                                            <b>{{ object.subscription_name }}</b>

                                                                            <span
                                                                                style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                                <b> â‚¹ {{ object.total_cost_without_gst|floatformat:3 }}</b>
                                                                            </span>
                                                                        </p>
                                                                        <p style="text-align: left;color: black; font-size: 15px;  padding-left: 5px;">
                                                                            Total SMS
                                                                            <span style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                                Per SMS Cost
                                                                            </span>
                                                                            <br>
                                                                            <b>{{ object.total_sms }}</b>
                                                                            <span
                                                                                style="float:right; color: black;text-align:left;padding-right: 10px">
                                                                                <b>â‚¹ {{object.per_sms_cost|floatformat:3}}</b>
                                                                            </span>
                                                                        </p>
                                                                        <p align="center" style="color: red">
                                                                            {% if sgst_value == 1 %}
                                                                            (CGST: 0) (SGST: 0)<br>
                                                                            (IGST: 18%): â‚¹{{object.gst_amount|floatformat:2}}<br>
                                                                            {% endif %}
                                                                            {% if igst_value == 1 %}
                                                                            (CGST: 9%): â‚¹{{object.state_wise_gst|floatformat:2}}<br>
                                                                            (SGST: 9%): â‚¹{{object.state_wise_gst|floatformat:2}}<br>
                                                                            (IGST: 0)
                                                                            {% endif %}
                                                                        </p>

                                                                    </div>
                                                                    <div class="modal-footer">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                            <!-- <p align="center" style="color: red">
                                              (Software Maintainance Cost: â‚¹ {{object.software_maintainace_cost}})
                                        </p> -->
                                        </div>
                                        <div class="tab-pane fade" id="v-pills-add-on" role="tabpanel" aria-labelledby="v-pills-add-on-tab">
                                            {% for object in addons_plans %}
                                                <div class="card">
                                                    <div class="card-body">
                                                        <div class="row">
                                                            <div class="col-sm-4">
                                                                <section style="padding-left: 15px;">
                                                                    <span><b>Add On's Name</b></span>
                                                                    <h1 style="color:#63b90b;font-size: 18px;"><b>{{ object.add_on_name }}</b></h1>
                                                                </section>
                                                            </div>
                                                            <div class="col-sm-3">
                                                                <section>
                                                                    <span><b>Recharge Amount</b></span>
                                                                    <h1 style="font-size: 20px; Color:#06529e"><b>â‚¹ {{object.total_cost_without_gst|floatformat:3}}</b></h1>
                                                                </section>
                                                            </div>
                                                            <div class="col-sm-2">
                                                                <section>
                                                                    <span><b>Amount</b></span>
                                                                    <h1 style="font-size: 20px; Color:#ffad47"><b>â‚¹ {{object.total_cost_without_gst|floatformat:3}}</b></h1>
                                                                </section>
                                                            </div>
                                                            <div class="col-sm-3" style="padding-top: 5px">
                                                                {% if active_subscription_object.id %}
                                                                    <form method="POST" action="{{ action }}">
                                                                        {% csrf_token %}
                                                                        <input type="hidden" name="key" value="{{ MERCHANT_KEY }}" />
                                                                        <input type="hidden" name="hash_string" value="{{ object.hash_string }}" />
                                                                        <input type="hidden" name="hash" value="{{ object.hashh }}"/>
                                                                        <input type="hidden" name="posted" value="{{ object.posted }}"/>
                                                                        <input type="hidden" name="txnid" value="{{ object.txnid }}" />
                                                                        <input type="hidden" name="amount" value="{{ object.recharge_amount }}" />
                                                                        <input type="hidden" name="firstname" id="firstname" value="{{ firstname }}" />
                                                                        <input type="hidden" name="productinfo" value="{{ object.productinfo }}">
                                                                        <input type="hidden" name="email" value="{{email}}">
                                                                        <input type="hidden" name="phone" value="{{phone}}">
                                                                        <input type="hidden" name="surl" value="{{add_on_surl}}">
                                                                        <input type="hidden" name="furl" value="{{add_on_furl}}">
                                                                        <input type="hidden" name="udf1" value="{{ object.udf1 }}">
                                                                        <input type="hidden" name="udf2" value="{{ object.udf2 }}">
                                                                        <input type="hidden" name="udf3" value="{{ object.udf3 }}">
                                                                        <input type="hidden" name="udf4" value="{{ object.udf4 }}">
                                                                        <input type="hidden" name="udf5" value="{{ object.udf5 }}">
                                                                        <input type="hidden" name="udf6" value="{{ object.udf6 }}">
                                                                        <input type="hidden" name="subscription_id" value="{{ object.id }}">
                                                                        <button type="button" class="btn btn-link" data-toggle="modal" data-target="#viewAddOndetailsmodal_{{forloop.counter}}" style="padding: .65rem 0.6rem;">View Details</button>
                                                                        <button type="submit" class="btn btn-sm" style="background-color: #06529e; color:white">Buy</button>
                                                                    </form>
                                                                {% else %}
                                                                    <button type="button" class="btn btn-link" data-toggle="modal" data-target="#viewAddOndetailsmodal_{{forloop.counter}}" style="padding: .65rem 0.6rem;">View Details</button>
                                                                    <button type="button" data-toggle="modal" data-target="#NoActiveGreenBillSubscriptionModal" style="background-color: #06529e; color:white" class="btn btn-sm">Buy</button>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="modal fade" id="viewAddOndetailsmodal_{{forloop.counter}}">
                                                            <div class="modal-dialog">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h3 class="modal-title w-100 text-center">{{ object.add_on_name }}</h3>
                                                                        <button type="button" class="close" data-dismiss="modal">
                                                                            Ã—
                                                                        </button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <section
                                                                            style="background-color :#06529e;border-radius:20px;border:2px solid #1572e9">
                                                                            <p style="text-align:center;"> <br>
                                                                                <span
                                                                                    style="color:white;text-align:center;font-size:50px;"><b>
                                                                                        â‚¹ {{object.recharge_amount|floatformat:3}}</b></span>
                                                                                <br>
                                                                            </p><br>
                                                                        </section>
                                                                        <hr>
                                                                        <p style="text-align: left;color: black; font-size: 15px;  padding-left: 5px;">
                                                                                Add On's Name
                                                                            <span style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                                Recharge Amount
                                                                            </span>
                                                                            <br>
                                                                            <b>{{ object.add_on_name }}</b>

                                                                            <span
                                                                                style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                                <b> â‚¹ {{ object.recharge_amount|floatformat:3 }}</b>
                                                                            </span>
                                                                        </p>

                                                                        {% if object.category_id == 11 or object.category_id == 12 %}
                                                                            <p style="text-align: left;color: black; font-size: 15px;  padding-left: 5px;">
                                                                                    Per Bill Cost
                                                                                <span style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                                    Per Digital Bill Cost
                                                                                </span>
                                                                                <br>
                                                                                <b>â‚¹ {{ object.per_bill_cost }}</b>
                                                                                <span
                                                                                    style="float:right; color: black;text-align:left;padding-right: 10px">
                                                                                    <b>â‚¹ {{object.per_digital_bill_cost}}</b></span>
                                                                            </p>
                                                                        {% else %}
                                                                            <p style="text-align: left;color: black; font-size: 15px;  padding-left: 5px;">
                                                                                    Per Bill Cost
                                                                                <span style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                                    Per Digital Bill Cost
                                                                                </span>
                                                                                <br>
                                                                                <b>â‚¹ {{ object.per_bill_cost }}</b>
                                                                                <span
                                                                                    style="float:right; color: black;text-align:left;padding-right: 10px">
                                                                                    <b>â‚¹ {{object.per_digital_bill_cost}}</b></span>
                                                                            </p>
                                                                            <!-- <p style="text-align: left; color: black;font-size: 15px;  padding-left: 5px;">
                                                                                Per Receipt Cost
                                                                                <span style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                                    Per Digital Receipt Cost
                                                                                </span>
                                                                                <br>
                                                                                <b> â‚¹ {{object.per_receipt_cost}}</b>
                                                                                <span
                                                                                    style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                                    <b> â‚¹ {{object.per_digital_receipt_cost}}</b></span>
                                                                            </p> -->
                                                                            <!-- <p style="text-align: left; color: black;font-size: 15px;  padding-left: 5px;">
                                                                                Per Cash Memo Cost
                                                                                <span style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                                    Per Digital Cash Memo Cost
                                                                                </span>
                                                                                <br>
                                                                                <b> â‚¹ {{object.per_cash_memo_cost}}</b>
                                                                                <span
                                                                                    style="float:right;color: black; text-align:left;padding-right: 10px">
                                                                                    <b> â‚¹ {{object.per_digital_cash_memo_cost}}</b></span>
                                                                            </p> -->
                                                                        {% endif %}
                                                                        <p align="center" style="color: red">
                                                                            (Software Maintainance Cost: â‚¹ {{object.software_maintainace_cost}})
                                                                        </p>
                                                                        <p align="center" style="color: red">
                                                                            {% if sgst_value == 1 %}
                                                                            (CGST: 0) (SGST: 0)<br>
                                                                            (include IGST: 18%)
                                                                            {% endif %}
                                                                            {% if igst_value == 1 %}
                                                                            (CGST: 9%) (SGST: 9%)
                                                                            (IGST: 0)
                                                                            {% endif %}
                                                                        </p>

                                                                    </div>
                                                                    <div class="modal-footer">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- NoActiveGreenBillSubscriptionModal -->

<div class="modal fade" id="NoActiveGreenBillSubscriptionModal">
        <div class="modal-dialog"> <!-- modal-sm -->
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title w-100 text-center" style="color: red;">No Active Subscription</h3>
                </div>
                <div class="modal-body">
                    <h4>You don't have active Green Bill Subscription. Please purchase one and try again.</h4>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </form> 
</div>

<div class="modal fade" id="buymodal">
    <form method="POST" action="{{ action }}" id="subscription-buy-form">
        {% csrf_token %}

        <div class="modal-dialog"> <!-- modal-sm -->
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title w-100 text-center">Buy Plan</h3>
                </div>
                
                <div class="modal-body">
                    <div class="form-check">
                        <div class="card col-md-12" style="width: 31rem;">
                            <div class="card-body">

                     
                                <div class="row">
                                    <div class="col-md-12" style="text-align:center;">
                                        <label class="form-check-label">Select Plan</label>
                                           <select name="valid_for_month" id="valid_for_month" class="form-control" required="">
                                                <option value="">Select</option>
                                               <option value="6">6 Months</option>
                                               <option value="12">12 Months</option>
                                           </select>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        
                    
                        <div class="card col-md-12" style="width: 31rem;">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-8" style="text-align:left; padding-left: 10  0px;">
                                        <h3>Total Amount</h3>
                                        <label>Min Recharge: â‚¹<span id="plan_recharge_amount"></span></label>
                                        {% if partner_user_id.p_state == 'Maharashtra' or partner_user_id.p_state == 'maharashtra' %}
                                        <label>SGST (9%): â‚¹<span id="gst1"></span></label>
                                        <label>CGST (9%): â‚¹<span id="gst2"></span></label>
                                        {% else %}
                                        <label>IGST (18%): â‚¹<span id="gst3"></span></label>
                                        {% endif %}
                                        <label>Total Cost: â‚¹<span id="final_total_cost"></span></label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <input type="hidden" name="recharge_amount1" value="" id="recharge_amount1">
                    <input type="hidden" name="months_data" value="" id="months_data" />
                    <input type="hidden" name="key" value="{{ MERCHANT_KEY }}" />
                    <input type="hidden" name="hash_string" value="" id="hash_string"/>
                    <input type="hidden" name="hash" value="" id="hashh"/>
                    <input type="hidden" name="posted" value="" id="posted" />
                    <input type="hidden" name="txnid" value="" id="txnid"/>
                    <input type="hidden" name="amount" value="" id="amount"/>
                    <input type="hidden" name="firstname" id="firstname" value="{{ firstname }}" />
                    <input type="hidden" name="productinfo" value="" id="productinfo">
                    <input type="hidden" name="email" value="{{email}}">
                    <input type="hidden" name="phone" value="{{phone}}">
                    <input type="hidden" name="surl" value="{{surl}}">
                    <input type="hidden" name="furl" value="{{furl}}">
                    <input type="hidden" name="udf1" value="" id="udf1">
                    <input type="hidden" name="udf2" value="" id="udf2">
                    <input type="hidden" name="udf3" value="" id="udf3">
                    <input type="hidden" name="udf4" value="" id="udf4">
                    <input type="hidden" name="udf5" value="" id="udf5">
                    <input type="hidden" name="udf6" value="" id="udf6">
                    <input type="hidden" name="subscription_id" value="" id="subscription_id">
                    <input type="submit" class="btn btn-primary" value="Buy">
                    <button type="button" class="btn btn-default" data-dismiss="modal" onClick="window.location.reload();">Close</button>
                </div>
            </div>
        </div>
    </form> 
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>

{% endblock content %}

<script>
    if ( window.history.replaceState ) {
    window.history.replaceState( null, null, window.location.href );
  }
  
        
    
</script>


{% block javascripts %}
<script type="text/javascript">
$(".buymodalBtn").on("click", function() {
        var plan_id = $(this).attr("data-plan-id")
        
        var recharge_amount1 = $(this).attr("data-recharge_amount");

        $("#udf5").val("");

        $("#subscription_id").val(plan_id);

        $("#recharge_amount1").val(recharge_amount1);
         $('#plan_recharge_amount').empty().append(Number(recharge_amount1).toFixed(3));

        $("#buymodal").modal();
    });

    $("#valid_for_month").on("change", function() {
        var amount = $("#recharge_amount1").val();
        var valid_for_month = $("#valid_for_month").val();

        var plan_id = $("#subscription_id").val();

        var subamount = parseFloat(amount) * parseFloat(valid_for_month)

        var gst_amount = (parseFloat(subamount)) * 0.18

        var final_cost = parseFloat(subamount) + parseFloat(gst_amount)

        $("#amount").val(final_cost);

        $('#gst3').empty().append(gst_amount);

        $('#gst1').empty().append(gst_amount/2);

        $('#gst2').empty().append(gst_amount/2);

        $('#final_total_cost').empty().append(Number(final_cost).toFixed(3));

        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        var csrftoken = getCookie('csrftoken');

        $.ajax({
            url: "/get-partner-subscription-plan-by-id/" + plan_id + "/",
            type: 'POST',
            data: { csrfmiddlewaretoken: csrftoken, month_validity:valid_for_month},
            success: function(data) {

                $("#hashh").val(data['hashh']);
                $("#posted").val(data['posted']);
                $("#txnid").val(data['txnid']);
                $("#hash_string").val(data['hash_string']);
                $("#amount").val(data['amount']);
                $("#productinfo").val(data['productinfo']);

                $("#udf1").val(data['udf1']);
                $("#udf2").val(data['udf2']);
                $("#udf3").val(data['udf3']);
                $("#udf4").val(data['udf4']);
                $("#udf5").val(data['udf5']);
                $("#udf6").val(data['udf6']);


                $("#subscription_id").val(data['subscription_id']);

                
            }
        });
        
    });
</script>

{% endblock javascripts %}