{% extends "layouts/partner-base.html" %} {% block title %} Offers {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %} {% block content %}



{% load static %}

<link rel="stylesheet" href="{% static 'assets/css/cropper.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/cropper.min.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/main.css' %}">
<style>
    /* Jquery validation */
    label {
        border: 0;
        margin-bottom: 3px;
        display: block;
        width: 100%;

    }
    a, a:hover, a:focus, a:active {
      text-decoration: none;
      color: inherit;
    }


    label {
        display: block;
        font: 1rem 'Fira Sans', sans-serif;
    }

    input {
        margin: .4rem 0;
    }

    /* Datatable => to float button right  */
    div.dt-buttons {
        position: relative;
        float: right;
        border-radius: 20px;
    }

    /* Datatable => rounded corner button  */
    button.dt-button {
        border-radius: 20px;
    }

    .permission-denied {
        color: red;
        display: flex;
        justify-content: center;
        font-size: 25px;
        font-weight: 500;
    }
</style>
<style>
    body {
        font-family: Arial;
    }

    .coupon {
        border: 5px #bbb;
        width: auto;
        border-radius: 15px;
        margin: 0 auto;
        max-width: 300px;
    }

    .container {
        padding: 2px 16px;
        background-color: #f1f1f1;
        text-align: center;
        padding-top: 10px;
    }

    .promo {
        background: #ccc;
        padding: 3px;
    }

    .expire {
        color: red;
    }

        <style>
  .product {
  margin: 50px auto;
  width: 350px;
  height: 200px;
  background: white;
  /* border: 1px solid #333; */
  position: relative;
  z-index: 90;
  

  color: rgb(19, 18, 18);
   
}
.coupon__title, .coupon__value {
      text-align: center;
      display: flex; justify-content: center ; padding-top: 10px;  position: relative; letter-spacing: 2px;

    }

.ribbon-wrapper {
  width: 85px;
  height: 88px;
  overflow: hidden;
  position: absolute;
  top: -3px;
  left: 11px;
}
  .ribbon {
    font: bold 15px sans-serif;
    color: #333;
    text-align: center;
    -webkit-transform: rotate(-45deg);
    -moz-transform:    rotate(-45deg);
    -ms-transform:     rotate(-45deg);
    -o-transform:      rotate(-45deg);
    position: relative;
    padding: 7px 0;
    top: 15px;
    left: -30px;
    width: 120px;
    background-color: #0aff6d ;
   
  }


  col{
  position: absolute;
    left: 55%;
    padding-bottom: 10px;
    padding-bottom: 0px;
    padding-left: 23px;
    bottom: -10%;
    bottom: 45%;
    width: 70%;
    
    border-radius: 30px; margin-right:90% ;

    transform: rotate(-90deg);
    -ms-transform: rotate(-90deg);
    -webkit-transform: rotate(-90deg);
    font-size: 1em;
    text-align: center;
    font-family: Helvetica;
    color: #301a1f;
    padding-right: 0px;
    
}
.width_set{
    width: 430px;
    height: 506px;

    
}
.body1{
    background: url('/http://157.230.228.250/media/offers/imgbackg.png');
    background-repeat: no-repeat;
    background-size: 100% 100%;
    height: 506px;
}
.content_name{
    font-size: 15px;
}
.body2{
    background: url('http://157.230.228.250/media/offers/background2.png');
    background-repeat: no-repeat;
    background-size: 100% 100%;
    
}
.closebtn{
    position: absolute;
    left: 406px;
    opacity: 0.3;
}


/* .backg{
    background: url('bgimg/bg.png')

}
.backc{
    background: url('bgimg/bg.png')

}*/

.coupon__body {
    margin-right: 45px;

    /* padding: 12px; */
    border-right: 2px dotted rgb(197, 148, 171);
    /* border-left: steelblue 10px solid; */
    margin-bottom: 20px;
    border-right: 30px;
    /* border-bottom: 4px solid #fa5b7d; */
    
 }  

 /* Smartphones (portrait and landscape) ----------- */
@media only screen 
and (min-device-width : 320px) 
and (max-device-width : 480px) {
/* Styles */

.cont {width :200px; background-color:#666666 !important;}
.cont .left {width :100px !important;}
.cont .right {width :100px !important;}
.logo_set{
	position: absolute;
	margin-left: 20px;
}

}



</style>
<div class="content">
    <div class="page-inner">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header" style="justify-content: center">
                        <div class="d-flex align-items-center">
                            <h4 class="card-title">Offers</h4>
                            <ul class="breadcrumbs">
                                <li class="nav-home">
                                    <a href="/partner-index/">
                                        <i class="flaticon-home"></i>
                                    </a>
                                </li>
                                <li class="separator">
                                    <i class="flaticon-right-arrow"></i>
                                </li>
                                <li class="nav-item">
                                    <a href="/partner-offer/">Offers</a>
                                </li>
                            </ul>
                            <div class=" ml-auto">
                                <!-- <div class="collapse" id="search-nav">
                                    <form class="navbar-left navbar-form nav-search mr-md-3" action="/partner-offer/" method="POST" autocomplete="off">
                                    {% csrf_token %}
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <button type="submit" class="btn btn-search pr-1">
                                                    <i class="fa fa-search search-icon"></i>
                                                </button>
                                            </div>
                                            <select class="form-control" name="offer_business_category" id="offer_business_category_name">
                                                <option value="All" name="offer_business_category">Search</option>
                                                {% for business_category in merchnat_business_category %}
                                                <option value="{{ business_category.business_category_name }}" name="offer_business_category"
                                                {% if business_category.id == merchant_general_setting.m_business_category_id %} 
                                                selected 
                                                {% endif %}>{{ business_category.business_category_name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </form>
                                </div> -->
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            {% if not data_offer %}
                                <h2 style="color: red; text-align: center;">No Current Offer Available</h2>
                            {% endif %}
                            {% for object in data_offer %}
                            
                            {% if object.status == "1" %}   
                                <div class="col-sm-4">
                                <a href="/view-partner-offer-details/{{ object.id }}">
                                    <div class="card" style="height:220px; width:220px;"> 
                                        <div class="form-group" style="padding-top:30px;">

                                        <span style="text-align: left; color: black; font-size: 15px;">    
                                            {{object.offer_name}}
                                         on</span>

                                        {% if object.offer_logo == '' %}
                                        {% if object.offer_panel == "merchant" %}
                                        <span style="text-align: left; color: black; font-size: 15px;">    
                                            {{object.merchant_business_name}}
                                        </span>
                                        {% endif %}
                                        {% if object.offer_panel == "owner" %}
                                        <span style="text-align: left; color: black; font-size: 15px;">    
                                            {{object.o_business_name}}
                                        </span>
                                        {% endif %}
                                        {% endif %}

                                        {% if object.offer_logo %}
                                        {% if object.offer_panel == "merchant" %}
                                        <span style="text-align: left; padding-left: 6px; color: black; font-size: 15px;">    
                                            {{object.merchant_business_name}}
                                        </span>
                                        {% endif %}
                                        {% if object.offer_panel == "owner" %}
                                        <span style="text-align: left; padding-left: 6px; color: black; font-size: 15px;">    
                                            {{object.o_business_name}}
                                        </span>
                                        {% endif %}
                                        {% endif %}
                                        </div><br>
                                        
                                        
                                        <!-- <img class="card-img-top" src="{{object.offer_image.url}}" width="auto" height="10px"> -->
                                        <div>                                        
                                            <div style="padding-left: 90px; transform: rotate(-20deg); margin-top: 30px; opacity: 0.4;">
                                          <img width="80" height="80" src="{{object.offer_image.url}}" id="">
                                        </div>
                                        </div>

                                        <div  style="padding-left:30px; border-color: ;  position: absolute; padding-top: 180px;">
                                            {% if object.offer_logo %}
                                                <img src="{{object.offer_logo.url}}" height="35" width="35" style="border-radius: 50%;" alt="Logo">
                                            {% endif %}
                                        </div>
                                    </div> 
                                    </a>          
                                </div>  
                            {% endif %}
                            {% endfor %}
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<div class="modal fade" id="DisplayOfferModal" role="dialog">
    <div class="modal-dialog" style="margin-right:500px; margin-top: 85px; width: 400px; height: 500px;">
        <div class="modal-content width_set">
        
            <div class="body1">
            
					<!-- style="background-image: url('/static/assets/img/bgimg.png');  background-repeat: no-repeat;" -->
					<img width="430" height="276" src="" id="view_offer_img">
                    <button type="button" class="closebtn" data-dismiss="modal">X</button>
				
                <div class="modal-body" style="">
					<p style="text-align: left;"> 
                        <span class="content_name" style="color:blue; padding-left: 20px; font-size: 23px"><b style="" id="offer_name_view"></b></span>
                        
                        <br>
                        <span style="color:rgb(0,100,0); padding-left: 20px; font-size: 23px"><b id="offer_caption_view"></b></span>
                        <br>
                        <b style="padding-left: 20px; font-size: 23px">Expires On:</b> <b style="font-size: 23px" id="offer_through_view"></b>
                        <br>
                        <span style="color:rgb(0,0,0); padding-left: 20px; font-size: 20px"><b style="" id="merchant_business_id_view"></b><span>
                        
					</p>
                    
                    <br><br>
			    </div>
            </div>
        </div>
    </div>
</div>




<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.29.2/sweetalert2.all.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>

{% if messages %}
{% for message in messages %}
<script>
    Swal.fire({
        "title": "Created",
        "text": "{{message}}",
        "icon": "success",

    })
</script>
{% endfor %}
{% endif %}




<script>
    if (window.history.replaceState) {
        window.history.replaceState(null, null, window.location.href);
    }



    $(".viewAdsBtn").on("click", function () {
    var offer_image = $(this).data("offer_image");
    var offer_name = $(this).data("offer_name");
    var offer_caption = $(this).data("offer_caption");
    var valid_through = $(this).data("valid_through");
    var merchant_business_id = $(this).data("merchant_business_id");
    

    

    $('#view_offer_img').attr('src', offer_image);
    $('#offer_name_view').val( offer_name);
    $('#offer_name_view').empty().append(offer_name);
    $('#offer_caption_view').empty().append(offer_caption);
    $('#offer_through_view').empty().append(valid_through);
    $('#merchant_business_id_view').empty().append(merchant_business_id);

    $("#DisplayOfferModal").modal();
});

    $(function () {
        $('.select-mode').click(function () {
            if ($(this).val() == 'percentage') {

                $('.percentage').prop({ readonly: false, });
                $('.value').prop({ readonly: true });
            }
            else if ($(this).val() == 'fix') {

                $('.percentage').prop({ readonly: true, });
                $('.value').prop({ readonly: false });
            }
            else if ($(this).val() == '') {
                $('.percentage').prop({ readonly: true, });
                $('.value').prop({ readonly: true });
            }
        });
    });

    $(document).ready(function(){
  
    $('.percentage').prop({ readonly: true, });
    $('.value').prop({ readonly: true });
    
});

    $(function () {
        $('.display').click(function () {
            if ($(this).val() == 'coupon_caption') {
                $('#percentage_id').hide()
                $('#value_id').hide()
                $('#hide_percent').hide()
                $('#hide_val').hide()
                $('#coupon_caption_id').show()
            }
            else if ($(this).val() == 'coupon_value') {
                $('#coupon_caption_id').hide()
                $('#percentage_id').show()
                $('#value_id').show()
                $('#hide_percent').show()
                $('#hide_val').show()
            }
        });
    });

    $(function () {
        $('.editdisplay').click(function () {
            if ($(this).val() == 'coupon_caption') {

                $('#edit_percentage_id').hide()
                $('#edit_value_id').hide()
                $('#edit_hide_percent').hide()
                $('#edit_hide_val').hide()
                $('#edit_coupon_caption_id').show()
            }
            else if ($(this).val() == 'coupon_value') {
                $('#edit_coupon_caption_id').hide()
                $('#edit_percentage_id').show()
                $('#edit_value_id').show()
                $('#edit_hide_percent').show()
                $('#edit_hide_val').show()
            }
        });
    });






    var viewmodaldiv = $("#view-modal-div");
    $(".editBtn").on("click", function () {
        var id_num = $(this).data('id')
        var offer_name = $(this).data("offer_name");
        var offer_caption = $(this).data('offer_caption');
        var valid_through = $(this).data('valid_through');
        var valid_from = $(this).data('valid_from')
        var offer_image = $(this).data('offer_image.url')
        var Offer_type = $(this).data('user')
        var offer_business_category = $(this).data('offer_business_category')
        var couponname = $(this).data("coupon_name");


        $("#edit_module_id").val(id_num)
        $('#edit_offer_name').val( offer_name);
        $('#edit_offer_caption').val( offer_caption);
        $('#edit_valid_from').val( valid_from);
        $('#edit_valid_through').val( valid_through);
        $('#edit_offer_business_category').val( offer_business_category);
        $('#edit_coupon_name').val( couponname);
        

        if (Offer_type == "Customer") {
            
            $('#edit_customer').prop('checked', true);
        }
        else if (Offer_type == "Merchant") {
            $('#edit_merchant').prop('checked', true);
        }
        
        

        $("#myEditModal").modal();

    });


    //for table validation

 
    $(function () {
        $('.deleteBtn').on('click', function (e) {
            e.preventDefault();
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes'
            }).then((result) => {
                if (result.isConfirmed) {
                    var id = $(this).attr("data-id");
                    $.ajax({
                        type: "POST",
                        url: "/delete-offer/" + id,
                        data: { csrfmiddlewaretoken: document.getElementsByName('csrfmiddlewaretoken')[0].value },
                        success: function (response) {
                            Swal.fire(

                                {
                                    title: 'Deleted!',
                                    text: 'Offer has been deleted',
                                    icon: 'success',
                                    timer: 1500,
                                    showConfirmButton: false,
                                })
                                .then(function () {
                                    location.reload();
                                });
                        },
                        error: function () {
                            Swal.fire({
                                title: 'Deleted!',
                                    text: 'Offer has been deleted',
                                    icon: 'success',
                                confirmButtonClass: "btn-success",
                                allowOutsideClick: false,
                                allowEscapeKey: false,
                                showConfirmButton: false,
                                timer: 1500
                            })
                                .then(function () {
                                    location.reload();
                                });
                        }
                    });
                }
            })
        });
    });



$(document).ready(function() {
  $('input[name=valid_through]').change(function() {
          var to_date = $('#valid_through').val();
          document.getElementById('valid_from').setAttribute("max", to_date);
  })

  $('input[name=valid_from]').change(function() {
    var from_date = $('#valid_from').val();
      document.getElementById('valid_through').setAttribute("min", from_date);
  })
})

if (window.history.replaceState) {
    window.history.replaceState(null, null, window.location.href);
}



$(document).ready(function() {
  $('input[name=edit_valid_through]').change(function() {
          var to_date = $('#edit_valid_through').val();
          document.getElementById('edit_valid_from').setAttribute("max", to_date);
  })

  $('input[name=edit_valid_from]').change(function() {
    var from_date = $('#edit_valid_from').val();
      document.getElementById('edit_valid_through').setAttribute("min", from_date);
  })
})

if (window.history.replaceState) {
    window.history.replaceState(null, null, window.location.href);
}


    function alphaOnly(event) {
        var key = event.keyCode;
        return ((key >= 65 && key <= 90) || key == 8);
    };


    $(document).ready(function () {
        $('#basic-datatables').DataTable({
        });

        $('#multi-filter-select').DataTable({
            "pageLength": 5,
            initComplete: function () {
                this.api().columns().every(function () {
                    var column = this;
                    var select = $('<select class="form-control"><option value=""></option></select>')
                        .appendTo($(column.footer()).empty())
                        .on('change', function () {
                            var val = $.fn.dataTable.util.escapeRegex(
                                $(this).val()
                            );

                            column
                                .search(val ? '^' + val + '$' : '', true, false)
                                .draw();
                        });

                    column.data().unique().sort().each(function (d, j) {
                        select.append('<option value="' + d + '">' + d + '</option>')
                    });
                });
            }
        });

        // Add Row
        // $('#add-row').DataTable({
        //     "pageLength": 5,
        // });

        $('#add-row').DataTable({
            dom: 'lBfrtip',
            "ordering": false,
            "lengthMenu": [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
            buttons: [
                'excel', 'pdf', 'print',
            ]
        });

        // buttons: [
        //         'copy', 'csv', 'excel', 'pdf', 'print'
        //     ]

        var action = '<td> <div class="form-button-action"> <button type="button" data-toggle="tooltip" title="" class="btn btn-link btn-primary btn-lg" data-original-title="Edit Task"> <i class="fa fa-edit"></i> </button> <button type="button" data-toggle="tooltip" title="" class="btn btn-link btn-danger" data-original-title="Remove"> <i class="fa fa-times"></i> </button> </div> </td>';

        $('#addRowButton').click(function () {
            $('#add-row').dataTable().fnAddData([
                $("#addName").val(),
                $("#addPosition").val(),
                $("#addOffice").val(),
                action
            ]);
            $('#addRowModal').modal('hide');

        });
    });

        $.validator.addMethod("validDate", function (value, element) {
        var currDate = new Date();
        var dd = currDate.getDate();
        var mm = currDate.getMonth()+1; 
        var yyyy = currDate.getFullYear();
        
        var todayDate = yyyy+'-'+dd+'-'+mm;

        
        return Date.parse(todayDate) < Date.parse(value) || value == "";
    }, "Please enter valid Date");


    function ValidateEndDate() {
       var startDate = document.getElementById("valid_from").value;
       var endDate = document.getElementById("valid_through").value;
       if (startDate != '' && endDate !='') {
           if (Date.parse(startDate) > Date.parse(endDate)) {
               // $("txttodate").val('');
               Swal.fire({
                
                text: "Valid from date should not be greater than vali to date!",
                icon: 'warning',
                showCancelButton: false,
                timer:2000,
                
            })
           }
       }
       return false;
   }


   $.validator.addMethod('filesize', function (value, element, param) {
    return this.optional(element) || (element.files[0].size <= param)
  }, 'File size must be less than 500 Kb');
        
    $("#add_merchant_form").validate({
        rules: {
            offer_name: {
                required: true,
            },
            valid_from: {
                required: true,
            },
            valid_through: {
                required: true,
            },
            offer_caption: {
                required: true
            },
            
            offer_business_category: {
                required: true
            },
            offer_image: {
                filesize: 500000
            },
            offer_logo: {
                filesize: 500000
            }
            
            
            
        },

        messages: {
            offer_name: {
                required: "Offer Name is Required",
            },
            valid_from: {
                required: "From Date is Required",
            },
            valid_through: {
                required: "To Date is Required",
            },
            
            offer_caption: {
                required: "Offer Caption is Required",
            },
            coupon_caption_name: {
                required: "Coupon Caption is Required",
            },
            offer_business_category: {
                required: "Business Category is Required",
            }, 
            

        },
        errorPlacement: function (error, element) {
            if (element.attr("name") == "valid_from")
                $("#valid_from_error").html(error);
            if (element.attr("name") == "offer_caption")
                $("#offer_caption_error").html(error);
            if (element.attr("name") == "offer_name")
                $("#offer_name_error").html(error);
            if (element.attr("name") == "valid_through")
                $("#valid_through_error").html(error);
            if (element.attr("name") == "offer_business_category")
                $("#offer_business_category_error").html(error);
                
            

        }

    });



</script>
<style>
    

    /* Datatable => to float button right  */
    div.dt-buttons {
        position: relative;
        float: right;
        border-radius: 20px;
    }

    /* Datatable => rounded corner button  */
    button.dt-button {
        border-radius: 20px;
    }

    .permission-denied {
        color: red;
        display: flex;
        justify-content: center;
        font-size: 25px;
        font-weight: 500;
    }
</style>

<script type="text/javascript">
    document.getElementById("offer_viewBtn").addEventListener("click", function(event){
      event.preventDefault()
    });
</script>









{% endblock content %}

{% block javascripts %}

{% endblock javascripts %}