{% extends "layouts/base.html" %} {% block title %} Merchant Offers {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %} 

{% block content %}

<style>
    /*.error {
            color: red;
            position:top;
        }*/

    /*.c1 {
            border: 2px red ridge;
        }*/

    /* Datatable => to float button right  */
    div.dt-buttons {
        position: relative;
        float: right;
        border-radius: 20px;
    }

    /* Datatable => rounded corner button  */
    button.dt-button {
        border-radius: 20px;
    }

    .permission-denied {
        color: red;
        display: flex;
        justify-content: center;
        font-size: 25px;
        font-weight: 500;
    }
</style>
<style type="text/css">
    .material-switch > input[type="checkbox"] {
        display: none;   
    }

    .material-switch > label {
        cursor: pointer;
        height: 0px;
        position: relative; 
        width: 40px;  
    }

    .material-switch > label::before {
        background: rgb(0, 0, 0);
        box-shadow: inset 0px 0px 10px rgba(0, 0, 0, 0.5);
        border-radius: 8px;
        content: '';
        height: 16px;
        margin-top: -8px;
        position:absolute;
        opacity: 0.3;
        transition: all 0.4s ease-in-out;
        width: 40px;
    }
    .material-switch > label::after {
        background: rgb(255, 255, 255);
        border-radius: 16px;
        box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.3);
        content: '';
        height: 24px;
        left: -4px;
        margin-top: -8px;
        position: absolute;
        top: -4px;
        transition: all 0.3s ease-in-out;
        width: 24px;
    }
    .material-switch > input[type="checkbox"]:checked + label::before {
        background: inherit;
        opacity: 0.5;
    }
    .material-switch > input[type="checkbox"]:checked + label::after {
        background: inherit;
        left: 20px;
    }
    .label-success{
      background-color: #66aa18 !important
    }

    /* Jquery validation */
    label {
        border: 0;
        margin-bottom: 3px;
        display: block;
        width: 100%;
    }

    /* Datatable => to float button right  */
    div.dt-buttons {
        position: relative;
        float: right;
        border-radius: 20px;
    }

    /* Datatable => rounded corner button  */
    button.dt-button {
        border-radius: 20px;
    }

    .permission-denied {
      color: red;
      display: flex;
      justify-content: center;
      font-size: 25px;
      font-weight: 500;
    }
.width_set{
    width: 430px;
    height: 506px;

    
}
.body1{
    background: url('http://157.230.228.250/media/offers/imgbackg.png');
    background-repeat: no-repeat;
    background-size: 100% 100%;
    height: 506px;
}
.content_name{
    font-size: 15px;
}
.body2{
    background: url('http://157.230.228.250/media/offers/background2.png');
    background-repeat: no-repeat;
    background-size: 100% 100%;
    
}
.closebtn{
    position: absolute;
    left: 406px;
    opacity: 0.3;
}
.decoration{
    text-decoration: none;
    color: rgb(105,105,105);
}


    
}
</style>
 
<div class="content">
    <div class="page-inner">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex align-items-center">
                            <h4 class="card-title">Merchant Offers</h4>
                            <ul class="breadcrumbs">
                                <li class="nav-home">
                                    <a href="/">
                                    <i class="flaticon-home"></i>
                                    </a>
                                </li>
                                <li class="separator">
                                    <i class="flaticon-right-arrow"></i>
                                </li>
                                <li class="nav-item">
                                    <a>Promotions</a>
                                </li>
                                <li class="separator">
                                <i class="flaticon-right-arrow"></i>
                                </li>
                                <li class="nav-item">
                                <a href="/offer-status/">Merchant Offers</a>
                                </li>
                            </ul>
                            
                        </div>
                    </div>
                    <div class="content">
        <div class="page-inner">
              <div class="row ">
                    <div class=" col-md-3">
                        <div class="row">
                         <div class="card card-stats card-round" style="margin-left:15px;">
                            <div class="card-body">
                              <div class="row align-items-center">
                                <div class="col-icon">
                                  <div class="icon-big text-center icon-primary bubble-shadow-small" style="background:blue">
                                    <i class="fas fa fas fa-user"></i>
                                  </div>
                                </div>
                                <div class="col col-stats ml-3 ml-sm-0">
                                  <div class="numbers">
                                    <p class="card-category">Total Count</p>
                                    <h4 class="card-title">{{total_offers}}</h4>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                    </div> 
                    <div class=" col-md-3">
                        <div class="row">
                         <div class="card card-stats card-round" style="margin-left:15px;">
                            <div class="card-body">
                              <div class="row align-items-center">
                                <div class="col-icon">
                                  <div class="icon-big text-center icon-primary bubble-shadow-small" style="background:blue">
                                    <i class="fa fa-spinner"></i>
                                  </div>
                                </div>
                                <div class="col col-stats ml-3 ml-sm-0">
                                  <div class="numbers">
                                    <p class="card-category">Waiting For Approval</p>
                                    <h4 class="card-title">{{waiting_offers}}</h4>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                    </div>
                    <div class=" col-md-3">
                        <div class="row">
                         <div class="card card-stats card-round" style="margin-left:15px;">
                            <div class="card-body">
                              <div class="row align-items-center">
                                <div class="col-icon">
                                  <div class="icon-big text-center icon-primary bubble-shadow-small" style="background:blue">
                                    <i class="fas fa-thumbs-up"></i>
                                  </div>
                                </div>
                                <div class="col col-stats ml-3 ml-sm-0">
                                  <div class="numbers">
                                    <p class="card-category">Approved</p>
                                    <h4 class="card-title">{{approve_offers}}</h4>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                    </div>
                    <div class=" col-md-3">
                        <div class="row">
                         <div class="card card-stats card-round" style="margin-left:15px;">
                            <div class="card-body">
                              <div class="row align-items-center">
                                <div class="col-icon">
                                  <div class="icon-big text-center icon-primary bubble-shadow-small" style="background:blue">
                                    <i class="fas fa-thumbs-down"></i>
                                  </div>
                                </div>
                                <div class="col col-stats ml-3 ml-sm-0">
                                  <div class="numbers">
                                    <p class="card-category">Disapproved</p>
                                    <h4 class="card-title">{{disaproved_offers}}</h4>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

                    {% if is_superuser == True %}
                        <div class="card-body">
                            <div class="table-responsive">
                                <!-- <div>
                                    <span class="card-title">&nbsp;&nbsp;Total Count &nbsp;{{total_offers}}</span>
                                  
                                    <span class="card-title">&nbsp;&nbsp;|&nbsp;&nbsp;Waiting For Approval &nbsp;{{waiting_offers}}</span>
                                  
                                    <span class="card-title">&nbsp;&nbsp;|&nbsp;&nbsp;Approved &nbsp;{{approve_offers}}</span>
                                </div><br> -->

                                <table id="add-row" class="display table table-hover" align="center">
                                    <thead>
                                        <tr>
                                        <th style="text-align: center;">Sr. No</th>   
                                        <th style="text-align: center;">Business Name</th>
                                        <th style="text-align: center;">Audience</th>
                                        
                                        <th style="text-align: center;">Created Date</th>
                                        
                                        <th style="text-align: center;">Status</th>
                                        <th style="text-align: center;">Amount</th>
                                        <th style="text-align: center;">Total Users</th>
                                        <th style="text-align: center;">Clicks</th>

                                        <th style="text-align: center;">Action</th>
                                         
                                            
                                        </tr>
                                    </thead>
                                    <tfoot>
            
                                    </tfoot>
                                    <tbody>
                                        {% for data_status in data_status1 %}
                                        {% if data_status.offer_panel == "merchant" %}
                                        <tr align="center">
                                            <td>{{forloop.counter }}</td>
                                         <td style="text-align: center;">{{data_status.merchant_business_name}}</td>
                                            <td style="text-align: center;">{{data_status.Offer_type}}</td>

                                        <td style="text-align: center;" width="14%">{{ data_status.created_date|date:'d-m-Y' }}</td>
                                        
                                        

                                        <td style="text-align: center;">{% if data_status.status == "0" %}
                                                Waiting For Approval
                                                {% elif data_status.status == "1" %}
                                                Approved
                                                {% elif data_status.status == "2" %}
                                                <button type="button" class="btn btn-link decoration" data-toggle="tooltip" data-original-title="{{data_status.disapproved_reason}}">
                                                Disapproved
                                                </button>
                                                {% endif %}</td>
                                                <td style="text-align: center;">₹ {{data_status.offer_amount|floatformat:2}}</td>
                                                <td style="text-align: center;">                                               
                                                {{data_status.customer_merchant_count}}
                                                        <!--  -->
                                                        
                                                </td>
                                                <td style="text-align: center;">{{ data_status.cout }}</td>
                                                <td style="text-align: center;">

                                        <div class="form-button-action">

                            
                                            <button type="button" class="btn btn-link viewAdsBtn"
                                                        data-toggle="tooltip" data-target="#exampleModal" id="view-modal-div"
                                                        data-original-title="View Offer" data-url="{{coup.id}}"
                                                        data-id="{{data_status.id}}" 
                                                        data-offer_name="{{data_status.offer_name}}" 
                                                        data-offer_caption="{{data_status.offer_caption}}"
                                                        data-offer_logo="{{data_status.offer_logo}}"
                                                        data-offer_image="{{ data_status.offer_image.url }}"
                                                        data-valid_through="{{data_status.valid_through|date:'d-m-Y'}}"
                                                        data-merchant_business_name="{{data_status.merchant_business_name}}"
                                                        >
                                                        <i class="fas fa-eye"></i>
                                            </button>
                            
                                            <!-- <span data-original-title="Amount" data-toggle="tooltip">
                                            {% if data_status.status == "0" %}
                                            
                                             <button type="submit" class="btn btn-link btn-primary AdsAmount" data-id="{{data_status.id}}" data-original-title="Add Amount" data-toggle="modal" data-target="#amountModal"><i class="fa fa-plus"></i></button>
                                             

                                            {% endif %}
                                            </span> -->
                            

                                            {% if data_status.status == "0" %}
                                            <button type="submit" class="btn btn-link btn-primary AdsApproveBtn" data-id="{{data_status.id}}" data-original-title="Payment Received" data-toggle="tooltip"><i class="fas fa-money-bill-alt"></i></button>
                                            {% endif %}
                                       
                                            <span data-original-title="Disapprove" data-toggle="tooltip">
                                            {% if data_status.status == "0" %}
                                                <button type="button" class="btn btn-link btn-danger AdsDisapproveBtn" data-id="{{data_status.id}}" data-original-title="Disapprove" data-toggle="modal" data-target="#reasonModal"><i class="fa fa-thumbs-down"></i></button>
                                            {% endif %}
                                            </span>
                          
                                            </td>
                                        </tr>
                                        {% endif %}
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    {% else %}
                        {% for actions in action_permissions_list %}
                            {% if actions.module_id|lower == "Promotions"|lower and actions.feature_id|lower == "Merchant Offers"|lower %}
                                {% if actions.view_permission == "1" %}
                                    <input type="hidden" value="1" name="access_permission" id="access_permission">
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <!-- <div>
                                                <span class="card-title">&nbsp;&nbsp;Total Count &nbsp;{{total_offers}}</span>
                                              
                                                <span class="card-title">&nbsp;&nbsp;|&nbsp;&nbsp;Waiting For Approval &nbsp;{{waiting_offers}}</span>
                                              
                                                <span class="card-title">&nbsp;&nbsp;|&nbsp;&nbsp;Approved &nbsp;{{approve_offers}}</span>
                                            </div><br> -->

                                            <table id="add-row" class="display table table-hover" align="center">
                                                <thead>
                                                    <tr>
                                                    <th style="text-align: center;">Sr. NO</th>    
                                                    <th style="text-align: center;">Business Name</th>
                                                    <th style="text-align: center;">Audience</th>
                                                    
                                                    <th style="text-align: center;">Created Date</th>
                                                    
                                                    <th style="text-align: center;">Status</th>
                                                    <th style="text-align: center;">Amount</th>
                                                    <th style="text-align: center;">Total Users</th>
                                                    <th style="text-align: center;">Clicks</th>

                                                    <th style="text-align: center;">Action</th>
                                                     
                                                        
                                                    </tr>
                                                </thead>
                                                <tfoot>
                        
                                                </tfoot>
                                                <tbody>
                                                    {% for data_status in data_status1 %}
                                                    {% if data_status.offer_panel == "merchant" %}
                                                    <tr align="center">
                                                        <td>{{forloop.counter }}</td>
                                                     <td style="text-align: center;">{{data_status.merchant_business_name}}</td>
                                                        <td style="text-align: center;">{{data_status.Offer_type}}</td>

                                                    <td style="text-align: center;" width="14%">{{ data_status.created_date|date:'d-m-Y' }}</td>
                                                    
                                                    

                                                    <td style="text-align: center;">{% if data_status.status == "0" %}
                                                            Waiting For Approval
                                                            {% elif data_status.status == "1" %}
                                                            Approved
                                                            {% elif data_status.status == "2" %}
                                                            <button type="button" class="btn btn-link decoration" data-toggle="tooltip" data-original-title="{{data_status.disapproved_reason}}">
                                                            Disapproved
                                                            </button>
                                                            {% endif %}</td>
                                                            <td style="text-align: center;">{{data_status.total_amount}}</td>
                                                            <td style="text-align: center;">                                               
                                                            {{data_status.customer_merchant_count}}
                                                                    <!--  -->
                                                                    
                                                            </td>
                                                            <td style="text-align: center;">{{ data_status.cout }}</td>
                                                            <td style="text-align: center;">

                                                    <div class="form-button-action">

                                        
                                                        <button type="button" class="btn btn-link viewAdsBtn"
                                                                    data-toggle="tooltip" data-target="#exampleModal" id="view-modal-div"
                                                                    data-original-title="View Offer" data-url="{{coup.id}}"
                                                                    data-id="{{data_status.id}}" 
                                                                    data-offer_name="{{data_status.offer_name}}" 
                                                                    data-offer_caption="{{data_status.offer_caption}}"
                                                                    data-offer_logo="{{data_status.offer_logo}}"
                                                                    data-offer_image="{{ data_status.offer_image.url }}"
                                                                    data-valid_through="{{data_status.valid_through|date:'d-m-Y'}}"
                                                                    data-merchant_business_name="{{data_status.merchant_business_name}}"
                                                                    >
                                                                    <i class="fas fa-eye"></i>
                                                        </button>
                                        
                                                        <!-- <span data-original-title="Amount" data-toggle="tooltip">
                                                        {% if data_status.status == "0" %}
                                                        
                                                         <button type="submit" class="btn btn-link btn-primary AdsAmount" data-id="{{data_status.id}}" data-original-title="Add Amount" data-toggle="modal" data-target="#amountModal"><i class="fa fa-plus"></i></button>
                                                         

                                                        {% endif %}
                                                        </span> -->
                                        

                                                        {% if data_status.status == "0" %}
                                                        <button type="submit" class="btn btn-link btn-primary AdsApproveBtn" data-id="{{data_status.id}}" data-original-title="Payment Received" data-toggle="tooltip"><i class="fas fa-money-bill-alt"></i></button>
                                                        {% endif %}
                                                   
                                                        <span data-original-title="Disapprove" data-toggle="tooltip">
                                                        {% if data_status.status == "0" %}
                                                            <button type="button" class="btn btn-link btn-danger AdsDisapproveBtn" data-id="{{data_status.id}}" data-original-title="Disapprove" data-toggle="modal" data-target="#reasonModal"><i class="fa fa-thumbs-down"></i></button>
                                                        {% endif %}
                                                        </span>
                                      
                                                        </td>
                                                    </tr>
                                                    {% endif %}
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        <div class="card-body permission-denied" style="display:none">
                            <div class="permission-denied" style="padding: 5%">Permission Denied</div> 
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="reasonModal" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <form method="POST" class="form" id="add_reason_form" autocomplete="off">
        {% csrf_token %}
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title w-100 text-center">Add Reason</h2>
          </div>
          <div class="modal-body">
            <input type="hidden" id="disapprove_offer_id" name="disapprove_offer_id" value="" />
            <input type="text" class="form-control" id="reason" name="reason" placeholder="Reason *"/>
          </div>
          <div class="modal-footer">
            <input id="add_reason_form_submit" type="submit" class="btn btn-primary" value="Save">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </form>
    </div>
  </div>

<!-- View Ads Modal Start -->
<!-- <div class="modal fade" id="DisplayOfferModal" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content width_set" style="width: 430px; height: 440px; margin-top: 85px; margin-left: 100px;">
                <div style="padding-left: 20px; margin-top: 15px;">
                    <img width="390" height="300" src="" id="view_offer_img">
                </div>    
                
                
                    <p>
                    <h3 style="padding-left: 20px; color: green;"><b style="" id="merchant_business_name_view""></b></h4>
                    <h3 style="padding-left: 20px; color: black;"><span id="offer_caption_view""></span></h4>
                    <h6 style="padding-left: 20px; color: darkgrey;">Expires On: <span id="offer_through_view"></span><h4></p>
                
        </div>
    </div>
</div> -->

<div class="modal fade" id="DisplayOfferModal" role="dialog">
    <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="row ">
                        <div class="col-md-12">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="row">
                                        <div class="col-md-3"></div>
                                            <div class="col-md-4">
                                                <div class="product" >
                                                    <div style=" overflow: hidden;  box-shadow: 12px 12px 12px 12px rgb(221, 218, 218);  border-radius: 12px; padding-top: 35px; width:220px; height: 220px; background-repeat: no-repeat; background-size: 100% 100%; ">
                                                         <div class=" text-left">
                                                            <h4 style="padding-left: 10px;text-transform: lowercase; color: black;"><span id="offer_name_view"></span> on</h4> 
                                                            <h4 style="padding-left: 10px; color: black;"><b style="" id="merchant_business_name_view"></b></h4>
                                                            <h4 style="padding-left: 10px; text-transform: lowercase; color: black;"><b style="" id="o_business_name_view"></b></h4>
                                                    </div>
                                        
                                                    <div class=" form-group">
                                                        <div style="padding-left: 110px; transform: rotate(-20deg); padding-top:  0px; opacity: 0.4;">
                                                            <img width="80" height="80" src="" id="view_offer_img">
                                                        </div> 
                                                        <div id="offer_logo"  style="padding-left:10px;  padding-bottom: 60px;">
                                                    </div>
                                                    </div>
                                                    <div class="form-group">
                                                       
                                                    
                                                    </div>
                                                </div>
                                            </div> 
                                        </div>
                                    </div>
                                    
                                    <div style="text-align: center;">
                                        <div class="row text-center" style="padding-top: 2%">
                                            <div class="col-md-2"></div>
                                                <div class="col-md-7">
                                                    
                                                    <div class="row" style="margin-top: 5px; margin-left: px;"> 
                                                        
                                                    <h4 style="padding-left: 65px; color: black;"><span id="offer_caption_view"></span></h4></b>
                                                    </h4>
                                                   </div>
                                                    <h5 style="padding-left: px; color: darkgrey;">Expires On: <span id="offer_through_view"></span><h5></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <div class="modal-footer">
            </div>
        </div>
    </div>
</div> 

<div class="modal fade" id="amountModal" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <form method="POST" class="form" id="add_amount_form" autocomplete="off" class="validator-form">
        {% csrf_token %}
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title w-100 text-center">Add Amount</h2>
          </div>
          <div class="modal-body">
            <input type="hidden" id="offer_amount_id" name="offer_amount_id" value="" />
            <input type="number" class="form-control" id="offer_amount" name="offer_amount" placeholder="Amount *"/>
          </div>
          <div class="modal-footer">
            <input id="add_amount_form_submit" type="submit" class="btn btn-primary" value="Save">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </form>
    </div>
  </div>


<!-- SCRIPTS -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.2/jquery.validate.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.2/additional-methods.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.29.2/sweetalert2.all.js"></script>
<!-- <script type="text/javascript">
    $("#add_amount_form").validate({
        rules: {
            offer_amount: {
                required: true,
                min: 1,
            },           
        },

        messages: {
            offer_amount: {
                required: "Amount is required",
                min: "Value must be greater than 0",
            },
        },
        

    });
</script> -->

<script>
    $('.AdsAmount').on('click', function(e) {
    var id = $(this).attr("data-id");
    $('#offer_amount_id').val(id);
});
$('#add_amount_form').validate({
    rules: {
            offer_amount: {
                required: true,
                min: 1,
            },           
        },

        messages: {
            offer_amount: {
                required: "Amount is required",
                min: "Value must be greater than 0",
            },
        },
    submitHandler: function () {
      
            $.ajax({
            type: "POST",
            url: "/add-offer-amount-for-merchant/",
            data: $('#add_amount_form').serialize(),
            success: function(response) {
            Swal.fire(
                {
                    title:'Added!',
                    text:'Amount Added Successfully !!!',
                    icon:'success',
                    timer:1500,
                    showConfirmButton:false,
                })
            .then(function() {
                location.reload();
            });
            },
            error: function() {
            Swal.fire({
                icon:"error",
                title: "Oops...", 
                text: "Something went wrong!", 
                timer:1500,
                showConfirmButton:false,
                allowOutsideClick: false,
                allowEscapeKey: false
            })
                .then(function() {
                location.reload();
                });       
            }
        });
      }
    });



</script>


<script>

$(".viewAdsBtn").on("click", function () {
    var offer_image = $(this).data("offer_image");
    var offer_logo = $(this).data('offer_logo');
    var offer_name = $(this).data('offer_name');
    var offer_caption = $(this).data("offer_caption");
    var valid_through = $(this).data("valid_through");
    var merchant_business_name = $(this).data("merchant_business_name");

    $("#offer_logo").empty();

    if(offer_logo != ""){
        $("#offer_logo").append('<img src="'+ "http://157.230.228.250/media/" + offer_logo
         + '" height="25" width="25" alt="Logo" style="border-radius:50%; border: 1px solid #00569D;">')   
    }

    $('#view_offer_name').empty().append(offer_name);

    $('#view_offer_img').attr('src', offer_image);
    $('#offer_name_view').empty().append(offer_name);
    $('#offer_caption_view').empty().append(offer_caption);
    $('#offer_through_view').empty().append(valid_through);
    $('#merchant_business_name_view').empty().append(merchant_business_name);

    $("#DisplayOfferModal").modal();
});

$('.AdsDisapproveBtn').on('click', function(e) {
    var id = $(this).attr("data-id");
    $('#disapprove_offer_id').val(id);
}); 

$('.AdsApproveBtn').on('click', function(e) {
    Swal.fire({
        title: 'Are you Received Payment?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, Received!'
    }).then((result) => {
        if (result.isConfirmed) {
        var id = $(this).attr("data-id");
        console.log("hi")
        $.ajax({
            type: "POST",
            url: "/approve-offer-by-id/"+id,
            data: {csrfmiddlewaretoken: document.getElementsByName('csrfmiddlewaretoken')[0].value},
            success: function(response) {
            Swal.fire(
                {
                    title:'Received!',
                    text:'Payment Received Successfully !!!',
                    icon:'success',
                    timer:1500,
                    showConfirmButton:false,
                })
            .then(function() {
                location.reload();
            });
            },
            error: function() {
            Swal.fire({
                icon:"error",
                title: "Oops...", 
                text: "Something went wrong!", 
                timer:1500,
                showConfirmButton:false,
                allowOutsideClick: false,
                allowEscapeKey: false
            })
                .then(function() {
                location.reload();
                });       
            }
        });
        }
    })
});

$('#add_reason_form').validate({
    rules:{
      reason:{
        required: true
      }
    },
    submitHandler: function () {
      Swal.fire({
        title: 'Are you sure?',
        text: "You really want to Disapprove this Offer!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, Disapprove it!'
      }).then((result) => {
        if (result.isConfirmed) {
            $.ajax({
            type: "POST",
            url: "/disapprove-offer-by-id/",
            data: $('#add_reason_form').serialize(),
            success: function(response) {
            Swal.fire(
                {
                    title:'Disapproved!',
                    text:'Offer Disapproved Successfully !!!',
                    icon:'success',
                    timer:1500,
                    showConfirmButton:false,
                })
            .then(function() {
                location.reload();
            });
            },
            error: function() {
            Swal.fire({
                icon:"error",
                title: "Oops...", 
                text: "Something went wrong!", 
                timer:1500,
                showConfirmButton:false,
                allowOutsideClick: false,
                allowEscapeKey: false
            })
                .then(function() {
                location.reload();
                });       
            }
        });
      }
    });
    }
  });
</script>
<script>
    if (window.history.replaceState) {
        window.history.replaceState(null, null, window.location.href);
    }


    //for table validation

 
    

    function alphaOnly(event) {
        var key = event.keyCode;
        return ((key >= 65 && key <= 90) || key == 8);
    };


    $(document).ready(function () {
        $('#basic-datatables').DataTable({
        });

        $('#multi-filter-select').DataTable({
            "pageLength": 5,
            initComplete: function () {
                this.api().columns().every(function () {
                    var column = this;
                    var select = $('<select class="form-control"><option value=""></option></select>')
                        .appendTo($(column.footer()).empty())
                        .on('change', function () {
                            var val = $.fn.dataTable.util.escapeRegex(
                                $(this).val()
                            );

                            column
                                .search(val ? '^' + val + '$' : '', true, false)
                                .draw();
                        });

                    column.data().unique().sort().each(function (d, j) {
                        select.append('<option value="' + d + '">' + d + '</option>')
                    });
                });
            }
        });

        // Add Row
        // $('#add-row').DataTable({
        //     "pageLength": 5,
        // });

        $('#add-row').DataTable({
            dom: 'lBfrtip',
            "ordering": false,
            // "lengthMenu": [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
            "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
            buttons: [
                'excel', 'pdf', 'print',
            ]
        });

        // buttons: [
        //         'copy', 'csv', 'excel', 'pdf', 'print'
        //     ]

        var action = '<td> <div class="form-button-action"> <button type="button" data-toggle="tooltip" title="" class="btn btn-link btn-primary btn-lg" data-original-title="Edit Task"> <i class="fa fa-edit"></i> </button> <button type="button" data-toggle="tooltip" title="" class="btn btn-link btn-danger" data-original-title="Remove"> <i class="fa fa-times"></i> </button> </div> </td>';

        $('#addRowButton').click(function () {
            $('#add-row').dataTable().fnAddData([
                $("#addName").val(),
                $("#addPosition").val(),
                $("#addOffice").val(),
                action
            ]);
            $('#addRowModal').modal('hide');

        });
    });

        $.validator.addMethod("validDate", function (value, element) {
        var currDate = new Date();
        var dd = currDate.getDate();
        var mm = currDate.getMonth()+1; 
        var yyyy = currDate.getFullYear();
        
        var todayDate = yyyy+'-'+dd+'-'+mm;

        
        return Date.parse(todayDate) < Date.parse(value) || value == "";
    }, "Please enter valid Date");


    function ValidateEndDate() {
       var startDate = document.getElementById("valid_from").value;
       var endDate = document.getElementById("valid_through").value;
       if (startDate != '' && endDate !='') {
           if (Date.parse(startDate) > Date.parse(endDate)) {
               // $("txttodate").val('');
               Swal.fire({
                
                text: "Valid from date should not be greater than vali to date!",
                icon: 'warning',
                showCancelButton: false,
                timer:2000,
                
            })
           }
       }
       return false;
   }
        





</script>
<style>

    /* Datatable => to float button right  */
    div.dt-buttons {
        position: relative;
        float: right;
        border-radius: 20px;
    }

    /* Datatable => rounded corner button  */
    button.dt-button {
        border-radius: 20px;
    }

    .permission-denied {
        color: red;
        display: flex;
        justify-content: center;
        font-size: 25px;
        font-weight: 500;
    }
</style>

{% endblock content %}
